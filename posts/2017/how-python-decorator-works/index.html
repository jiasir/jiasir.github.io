<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="jiasir"><meta name=description content="Decorators provide a simple syntax for calling higher-order functions. A decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it."><meta name=keywords content="jiasir,developer,devops,sre"><meta name=twitter:card content="summary"><meta name=twitter:title content="How Python Decorator Works"><meta name=twitter:description content="Decorators provide a simple syntax for calling higher-order functions. A decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it."><meta property="og:title" content="How Python Decorator Works"><meta property="og:description" content="Decorators provide a simple syntax for calling higher-order functions. A decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it."><meta property="og:type" content="article"><meta property="og:url" content="https://jiasir.io/posts/2017/how-python-decorator-works/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2017-03-16T00:00:00+00:00"><title>How Python Decorator Works · jiasir</title><link rel=canonical href=https://jiasir.io/posts/2017/how-python-decorator-works/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><meta name=generator content="Hugo 0.97.1"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>jiasir</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/categories/>Categories</a></li><li class=navigation-item><a class=navigation-link href=/series/>Series</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://jiasir.io/posts/2017/how-python-decorator-works/>How Python Decorator Works</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2017-03-16T00:00:00Z>March 16, 2017</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=authors><i class="fa fa-user" aria-hidden=true></i>
<a href=/authors/jiasir/>jiasir</a></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/2017/>2017</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/python/>Python</a></span></div></div></header><div><p>Decorators provide a simple syntax for calling higher-order functions. A decorator is a function that takes another function and extends the behavior of the latter function without explicitly modifying it.</p><h3 id=how-function-works>How function works
<a class=heading-link href=#how-function-works><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Functions return a value based on the given arguments.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(bar):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bar <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>print(foo(<span style=color:#ae81ff>2</span>)) <span style=color:#75715e># will print 3</span>
</span></span></code></pre></div><h3 id=what-is-first-class-object>What is first class object
<a class=heading-link href=#what-is-first-class-object><i class="fa fa-link" aria-hidden=true></i></a></h3><p>All objects that could be named in the language (e.g., integers, strings, functions, classes, modules, methods, etc.) to have equal status. That is, they can be assigned to variables, placed in lists, stored in dictionaries, passed as arguments, and so forth. That were &ldquo;first class&rdquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(bar):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bar <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>print(foo) <span style=color:#75715e># will print &lt;function foo at 0x100ec1488&gt;</span>
</span></span><span style=display:flex><span>print(foo(<span style=color:#ae81ff>2</span>)) <span style=color:#75715e># will print 3</span>
</span></span><span style=display:flex><span>print(type(foo)) <span style=color:#75715e># will print &lt;type &#39;function&#39;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>call_foo</span>(foo, arg):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> foo(arg)
</span></span><span style=display:flex><span>print(call_foo(foo, <span style=color:#ae81ff>3</span>)) <span style=color:#75715e># will print 4</span>
</span></span></code></pre></div><h3 id=nested-functions>Nested Functions
<a class=heading-link href=#nested-functions><i class="fa fa-link" aria-hidden=true></i></a></h3><p>This example shows the child functions are not available outside of the parent function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parent</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Printing from the parent() function.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>child_1</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Printing from the child_1() function.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>child_2</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Printing from the child_2() function.&#34;</span>
</span></span><span style=display:flex><span>    print(child_1())
</span></span><span style=display:flex><span>    print(child_2())
</span></span></code></pre></div><p>When you calling the <code>parent()</code> function, you should get that messages. But try calling the <code>child_1()</code> or <code>child_2()</code> function, you should get an error.</p><h3 id=returning-functions>Returning Functions
<a class=heading-link href=#returning-functions><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Python also allows you to return functions from other functions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parent</span>(num):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>child_1</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Printing from the child_1() function.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>child_2</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Printing from the child_2() function.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> num <span style=color:#f92672>==</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> child_1
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>AssertionError</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> child_2
</span></span><span style=display:flex><span>foo <span style=color:#f92672>=</span> parent(<span style=color:#ae81ff>10</span>) <span style=color:#75715e># variable foo is the same as child_1</span>
</span></span><span style=display:flex><span>bar <span style=color:#f92672>=</span> parent(<span style=color:#ae81ff>11</span>) <span style=color:#75715e># variable bar is the same as child_2</span>
</span></span><span style=display:flex><span>print(foo) <span style=color:#75715e># output: &lt;function child_1 at 0x100ec1578&gt;</span>
</span></span><span style=display:flex><span>print(bar) <span style=color:#75715e># output: &lt;function child_2 at 0x100ec15f0&gt;</span>
</span></span><span style=display:flex><span>print(foo()) <span style=color:#75715e># output: Printing from the child_1() function.</span>
</span></span><span style=display:flex><span>print(bar()) <span style=color:#75715e># output: Printing from the child_2() function.</span>
</span></span></code></pre></div><h3 id=decorators>Decorators
<a class=heading-link href=#decorators><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Now, that&rsquo;s show the decorators examples.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_decorator</span>(f):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>():
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Something is happening before f() is called.&#34;</span>)
</span></span><span style=display:flex><span>        f()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Something is happening after f() is called.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_function</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Calling my_function!&#34;</span>)
</span></span><span style=display:flex><span>my_function <span style=color:#f92672>=</span> my_decorator(my_function) <span style=color:#75715e># my_function is the same as wrapper</span>
</span></span><span style=display:flex><span>my_function() <span style=color:#75715e># my_function is the same as wrapper()</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Something is happening before f() is called.
</span></span><span style=display:flex><span>Calling my_function!
</span></span><span style=display:flex><span>Something is happening after f() is called.
</span></span></code></pre></div><p>We can using the syntactic sugar <code>@</code> symbol instead of variable assignment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_decorator</span>(f):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>():
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Something is happening before f() is called.&#34;</span>)
</span></span><span style=display:flex><span>        f()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Something is happening after f() is called.&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span><span style=color:#a6e22e>@my_decorator</span> <span style=color:#75715e># the same as my_function = my_decorator(my_function)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_function</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Calling my_function!&#34;</span>)
</span></span><span style=display:flex><span>my_function() <span style=color:#75715e># my_function is the same as wrapper()</span>
</span></span></code></pre></div><p><code>@my_decorator</code> is just an easier way of saying <code>my_function = my_decorator(my_function)</code>.</p><p>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Something is happening before f() is called.
</span></span><span style=display:flex><span>Calling my_function!
</span></span><span style=display:flex><span>Something is happening after f() is called.
</span></span></code></pre></div><p>Let&rsquo;s try another example. This decorator is used for rate limiting. Test it out.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> sleep
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>sleep_decorator</span>(f):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Limits how fast the function is
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    called.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        sleep(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> f(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span><span style=color:#a6e22e>@sleep_decorator</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_number</span>(num):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> num
</span></span><span style=display:flex><span>print(print_number(<span style=color:#ae81ff>1</span>))
</span></span></code></pre></div><p>This will sleep two seconds and print 1.</p><p>And the example shows decorator with arguments:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_decorator</span>(name<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>upper</span>(f):
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>inner</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        <span style=color:#75715e>#do something</span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> f(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> inner
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> upper
</span></span><span style=display:flex><span><span style=color:#a6e22e>@my_decorator</span>(name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;jiasir&#34;</span>) <span style=color:#75715e># the same as my_function = my_decorator(name=&#34;jiasir&#34;)(my_function)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>my_function</span>(num):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Calling my_function! Num: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> num)
</span></span><span style=display:flex><span>my_function(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># the same as my_decorator(name=&#34;jiasir&#34;)(my_function)(1)</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Calling my_function! Num: 1
</span></span></code></pre></div></div><footer><section class=see-also></section></footer></article></section></div><footer class=footer><section class=container>©
2017 -
2022
jiasir
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W3ZVM6WBMX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W3ZVM6WBMX",{anonymize_ip:!1})}</script></body></html>